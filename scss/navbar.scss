// This file is part of the Pimenko theme for Moodle
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
/**
 * Theme Pimenko style files.
 * @package    theme_pimenko
 * @copyright  Pimenko 2020
 * @author     Sylvain Revenu - Pimenko 2020 <contact@pimenko.com> <pimenko.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */

// Variables de couleurs
$navbar-bg-color: unquote('navbarcolor');
$navbar-text-color: unquote('navbartextcolor');
$navbar-hover-color: unquote('darkennavcolor');
$brand-button-color: unquote('brandcolorbutton');
$brand-button-text-color: unquote('brandcolortextbutton');
$brand-button-hover-color: unquote('darkenbrandcolorbutton');
$brand-button-hover-text-color: unquote('darkenbrandcolortextbutton');

// Variables de dimensions
$navbar-z-index: 1030;
$navbar-padding: 0 16px;
$navbar-height: 60px;
$navbar-logo-max-height: calc(#{$navbar-height} - (0.25rem * 2));
$popover-top-offset: 38px;
$dropdown-submenu-top-offset: -6px;

// Couleur par défaut pour les éléments du menu
$dropdown-default-text-color: #333;

nav.navbar.pimenko-navbar,
nav.navbar.pimenko-navbar.fixed-top {
    background-color: $navbar-bg-color !important;
    color: $navbar-text-color;
    position: fixed;
    z-index: $navbar-z-index;
    padding: $navbar-padding;

    .popover-region {
        height: 100%;
    }

    &.withnavbarpicture {
        background-repeat: no-repeat;
        background-size: auto;
    }

    // Header category select
    #header-category-select {
        .dropdown-menu {
            position: absolute;

            li:hover > ul.dropdown-menu {
                display: block;
            }

            .dropdown-submenu {
                position: relative;

                > .dropdown-menu {
                    left: 100%;
                    margin-top: $dropdown-submenu-top-offset;
                    top: 0;
                }
            }

            & > li > a {
                &:after {
                    border-bottom: 0;
                    border-left: 0.3em solid transparent;
                    border-right: 0.3em solid transparent;
                    border-top: 0.3em solid;
                    content: "";
                    display: inline-block;
                    font-size: 15px;
                    margin-left: 0.255em;
                    vertical-align: 0.255em;
                }

                &:hover:after {
                    text-decoration: underline;
                    transform: rotate(-90deg);
                }
            }
        }
    }

    // Navigation elements
    .navbar-nav {
        align-items: center;
        display: flex;

        li:not(.d-none):not(.dropdown.nav-item),
        input {
            display: flex !important;
        }
    }

    .navbar-brand {
        display: flex;
        padding-bottom: 0;
        padding-top: 0;

        .logo,
        .site-name {
            margin: auto;
        }
    }

    .nav-item:not(.dropdown.nav-item) {
        display: flex;
    }

    // Text colors
    .site-name,
    .editmode-switch-form label,
    .nav-item,
    :not(button).nav-link,
    .simplesearchform .btn,
    a {
        color: $navbar-text-color;
    }

    .editmode-switch-form {
        label.text-primary {
            color: $navbar-text-color !important;
        }

        .custom-switch .custom-control-input {
            height: 100%;
        }

        position: relative;
    }

    // Hover and focus states
    a,
    .popover-region-toggle {
        &:hover,
        &:focus {
            color: $navbar-hover-color !important;
        }
    }

    // Dropdown toggles
    .dropdown-toggle,
    .popover-region-toggle {
        &::after,
        &::before {
            display: none;
        }
    }

    // Popover region
    .popover-region-container {
        top: $popover-top-offset;
    }

    // Dropdown menu items
    .dropdown-menu a,
    .popover-region-container,
    .content-item-container a,
    .popover-region-header-actions a {
        color: $dropdown-default-text-color;
        line-height: initial;

        &.dropdown-item {
            padding-left: 1.75em;

            &:hover,
            &:active {
                background-color: $brand-button-hover-color;
                border-color: $brand-button-hover-color;
                color: $brand-button-hover-text-color !important;
            }

            &:focus,
            &:focus-within {
                background-color: $brand-button-color;
                border-color: $brand-button-color;
                color: $brand-button-text-color !important;

                &::before {
                    color: $brand-button-text-color;
                    content: "•";
                    display: inline-block;
                    left: 10px;
                    position: absolute;
                }
            }
        }
    }

    // Search form
    .simplesearchform .btn-submit {
        background-color: $brand-button-color;
    }

    // Custom switch
    .custom-switch .custom-control-label {
        align-items: center;
        color: $navbar-text-color;
        display: flex;
        justify-content: center;
        justify-items: center;
        text-align: center;

        &::after,
        &::before {
            top: initial;
        }
    }

    .custom-control {
        display: flex;
    }
}

// Primary navigation
.primary-navigation {
    .moremenu .nav-link {
        border-bottom: solid 3px;
        border-color: transparent;

        &:hover,
        &:focus {
            background: none;
        }

        &.active {
            border-bottom-color: $navbar-hover-color !important;
        }
    }
}

.moremenu .nav-link.active {
    border-bottom-color: $brand-button-color;
}

.navbar.fixed-top #header-category-select .dropdown .dropdown-menu {
    overflow-y: visible;
}

// Force logo size
.navbar.fixed-top .navbar-brand .logo {
    max-height: $navbar-logo-max-height;
}
