{"version":3,"file":"pimenko.min.js","sources":["../src/pimenko.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @copyright  Pimenko 2019\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\ndefine(['jquery', 'core/ajax'],\n    function($, ajax) {\n\n        \"use strict\";\n\n        let eventlistener = function() {\n            $(function() {\n                $(\"#completion-block\").tooltip({trigger: \"hover\"});\n            });\n\n            $(\".cover_file\").on(\"change\", function(event) {\n                let courseid = $(this).data(\"id\");\n                let filedelete = false;\n                if (courseid) {\n                    let file = event.target.files[0]; // Get only 1st file.\n                    let filedata = null;\n                    // Check if img.\n                    if (!file.type.match(\"image.*\")) {\n                        return;\n                    }\n                    let reader = new FileReader();\n\n                    reader.onload = (function(file) {\n                        return function(e) {\n\n                            // Set page header to use local version for now.\n                            filedata = e.target.result;\n\n                            let imagedata = filedata.split(\"base64,\")[1];\n                            let filename = file.name;\n\n                            let fileconverted = filedata;\n                            // Convert base64 to raw binary data held in a string.\n                            let byteString = atob(fileconverted.split(',')[1]);\n\n                            // Separate out the mime component.\n                            let mimeString = fileconverted.split(',')[0].split(':')[1].split(';')[0];\n\n                            // Write the bytes of the string to an ArrayBuffer.\n                            let arrayBuffer = new ArrayBuffer(byteString.length);\n                            let _ia = new Uint8Array(arrayBuffer);\n                            for (let i = 0; i < byteString.length; i++) {\n                                _ia[i] = byteString.charCodeAt(i);\n                            }\n\n                            let dataView = new DataView(arrayBuffer);\n                            fileconverted = new Blob([dataView], {type: mimeString});\n\n                            ajax.call([\n                                {\n                                    methodname: \"theme_pimenko_save_cover_file\",\n                                    args: {\n                                        imagedata: imagedata,\n                                        courseid: courseid,\n                                        filename: filename,\n                                        filedelete: filedelete\n                                    },\n                                    done: function(response) {\n                                        if (response.success) {\n                                            location.reload();\n                                        }\n                                    },\n                                    fail: function(response) {\n                                        // eslint-disable-next-line no-console\n                                        console.log(response);\n                                        // eslint-disable-next-line no-console\n                                        console.log(\"fail\");\n                                    }\n                                }\n                            ], true, true);\n                        };\n                    })(file);\n\n                    // Read img.\n                    reader.readAsDataURL(file);\n                }\n            });\n\n            $(\".delete-cover\").on(\"click\", function() {\n                let selector = $(\".cover_file\");\n                let courseid = selector.data(\"id\");\n                let filename = selector.data(\"name\");\n                let filedelete = true;\n\n                if (courseid) {\n                    ajax.call([\n                        {\n                            methodname: \"theme_pimenko_save_cover_file\",\n                            args: {\n                                courseid: courseid,\n                                filename: filename,\n                                filedelete: filedelete\n                            },\n                            done: function(response) {\n                                if (response.success) {\n                                    location.reload();\n                                }\n                            },\n                            fail: function(response) {\n                                // eslint-disable-next-line no-console\n                                console.log(response);\n                                // eslint-disable-next-line no-console\n                                console.log(\"fail\");\n                            }\n                        }\n                    ], true, true);\n                }\n            });\n        };\n\n        /**\n         * Add special classes to body depending on scroll position.\n         *\n         * @method  update\n         * @chainable\n         */\n        let scrollHandler = function() {\n            const body = document.querySelector('body');\n            const scrollY = getScrollPosition();\n            if (scrollY >= window.innerHeight) {\n                body.classList.add('scrolled');\n            } else {\n                body.classList.remove('scrolled');\n            }\n        };\n\n        let getScrollPosition = function() {\n            return window.pageYOffset || document.documentElement.scrollTop;\n        };\n\n        return {\n            init: function() {\n                eventlistener();\n                this.scrollY = 0;\n                window.addEventListener(\"scroll\", scrollHandler.bind(this));\n            }\n        };\n    });\n"],"names":["define","$","ajax","scrollHandler","body","document","querySelector","getScrollPosition","window","innerHeight","classList","add","remove","pageYOffset","documentElement","scrollTop","init","tooltip","trigger","on","event","courseid","this","data","file","target","files","filedata","type","match","reader","FileReader","onload","e","result","imagedata","split","filename","name","fileconverted","byteString","atob","mimeString","arrayBuffer","ArrayBuffer","length","_ia","Uint8Array","i","charCodeAt","dataView","DataView","Blob","call","methodname","args","filedelete","done","response","success","location","reload","fail","console","log","readAsDataURL","selector","scrollY","addEventListener","bind"],"mappings":";;;;AAqBAA,+BAAO,CAAC,SAAU,cACd,SAASC,EAAGC,UAmHJC,cAAgB,iBACVC,KAAOC,SAASC,cAAc,QACpBC,qBACDC,OAAOC,YAClBL,KAAKM,UAAUC,IAAI,YAEnBP,KAAKM,UAAUE,OAAO,aAI1BL,kBAAoB,kBACbC,OAAOK,aAAeR,SAASS,gBAAgBC,iBAGnD,CACHC,KAAM,WA7HNf,GAAE,WACEA,EAAE,qBAAqBgB,QAAQ,CAACC,QAAS,aAG7CjB,EAAE,eAAekB,GAAG,UAAU,SAASC,WAC/BC,SAAWpB,EAAEqB,MAAMC,KAAK,SAExBF,SAAU,KACNG,KAAOJ,MAAMK,OAAOC,MAAM,GAC1BC,SAAW,SAEVH,KAAKI,KAAKC,MAAM,sBAGjBC,OAAS,IAAIC,WAEjBD,OAAOE,OAAU,SAASR,aACf,SAASS,GAGZN,SAAWM,EAAER,OAAOS,WAEhBC,UAAYR,SAASS,MAAM,WAAW,GACtCC,SAAWb,KAAKc,KAEhBC,cAAgBZ,SAEhBa,WAAaC,KAAKF,cAAcH,MAAM,KAAK,IAG3CM,WAAaH,cAAcH,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,GAGlEO,YAAc,IAAIC,YAAYJ,WAAWK,QACzCC,IAAM,IAAIC,WAAWJ,iBACpB,IAAIK,EAAI,EAAGA,EAAIR,WAAWK,OAAQG,IACnCF,IAAIE,GAAKR,WAAWS,WAAWD,OAG/BE,SAAW,IAAIC,SAASR,aAC5BJ,cAAgB,IAAIa,KAAK,CAACF,UAAW,CAACtB,KAAMc,aAE5CxC,KAAKmD,KAAK,CACN,CACIC,WAAY,gCACZC,KAAM,CACFpB,UAAWA,UACXd,SAAUA,SACVgB,SAAUA,SACVmB,YA3CP,GA6CGC,KAAM,SAASC,UACPA,SAASC,SACTC,SAASC,UAGjBC,KAAM,SAASJ,UAEXK,QAAQC,IAAIN,UAEZK,QAAQC,IAAI,YAGrB,GAAM,IA/CA,CAiDdxC,MAGHM,OAAOmC,cAAczC,UAI7BvB,EAAE,iBAAiBkB,GAAG,SAAS,eACvB+C,SAAWjE,EAAE,eACboB,SAAW6C,SAAS3C,KAAK,MACzBc,SAAW6B,SAAS3C,KAAK,QAGzBF,UACAnB,KAAKmD,KAAK,CACN,CACIC,WAAY,gCACZC,KAAM,CACFlC,SAAUA,SACVgB,SAAUA,SACVmB,YATC,GAWLC,KAAM,SAASC,UACPA,SAASC,SACTC,SAASC,UAGjBC,KAAM,SAASJ,UAEXK,QAAQC,IAAIN,UAEZK,QAAQC,IAAI,YAGrB,GAAM,WA4BRG,QAAU,EACf3D,OAAO4D,iBAAiB,SAAUjE,cAAckE,KAAK/C"}